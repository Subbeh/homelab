---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  secret-tailscale:
    internal: true
    cmd: task run -- k8s/tailscale client_id={{.client_id}} client_secret={{.client_secret}}
    vars:
      client_id:
        sh: bwget tailscale k8s-client-id
      client_secret:
        sh: bwget tailscale k8s-client-secret

  secret-rook-ceph:
    internal: true
    cmd: task run -- k8s/rook-ceph password={{.password}}
    vars:
      password:
        sh: bww get password rook.sbbh.cloud

  secret-alertmanager:
    internal: true
    cmd: task run -- k8s/alertmanager pushover_token={{.pushover_token}} pushover_user_key={{.pushover_user_key}} heartbeat_url={{.heartbeat_url}}
    vars:
      pushover_token:
        sh: bwget pushover api-token
      pushover_user_key:
        sh: bwget pushover user-key
      heartbeat_url:
        sh: bwget healthchecks.io heartbeat_url

  secret-grafana:
    internal: true
    cmd: task run -- k8s/grafana user={{.user}} password={{.password}}
    vars:
      user:
        sh: bww get username grafana.sbbh.cloud
      password:
        sh: bww get password grafana.sbbh.cloud
