---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

tasks:
  secret-audiobookshelf:
    internal: true
    cmd: task run -- media/audiobookshelf api_key={{.api_key}}
    vars:
      api_key:
        sh: bwget audiobookshelf.sbbh.cloud api-key

  secret-sabnzbd:
    internal: true
    cmd: task run -- media/sabnzbd api_key={{.api_key}}
    vars:
      api_key:
        sh: bwget sabnzbd.sbbh.cloud api-key

  secret-radarr:
    internal: true
    cmd: task run -- media/radarr api_key={{.api_key}}
    vars:
      api_key:
        sh: bwget radarr.sbbh.cloud api-key

  secret-sonarr:
    internal: true
    cmd: task run -- media/sonarr api_key={{.api_key}}
    vars:
      api_key:
        sh: bwget sonarr.sbbh.cloud api-key

  secret-prowlarr:
    internal: true
    cmd: task run -- media/prowlarr api_key={{.api_key}}
    vars:
      api_key:
        sh: bwget prowlarr.sbbh.cloud api-key

  secret-bazarr:
    internal: true
    cmd: task run -- media/bazarr api_key={{.api_key}}
    vars:
      api_key:
        sh: bwget bazarr.sbbh.cloud api-key

  secret-plex:
    internal: true
    cmd: task run -- media/plex token={{.token}}
    vars:
      token:
        sh: bwget plex.sbbh.cloud token

  secret-kometa:
    internal: true
    cmd: task run -- media/kometa mdblist_key={{.mdblist_key}} omdb_key={{.omdb_key}} tmdb_key={{.tmdb_key}}
    vars:
      mdblist_key:
        sh: bwget mdblist.com api-key
      omdb_key:
        sh: bwget omdbapi.com api-key
      tmdb_key:
        sh: bwget themoviedb.org api-key

  secret-calibre:
    internal: true
    cmd: task run -- media/calibre user='{{.user}}' password='{{.password}}'
    vars:
      user:
        sh: bww get username calibre.sbbh.cloud
      password:
        sh: bww get password calibre.sbbh.cloud

  secret-qbittorrent:
    internal: true
    cmd: task run -- media/qbittorrent user='{{.user}}' password='{{.password}}' mam_id='{{.mam_id}}'
    vars:
      user:
        sh: bww get username qbittorrent.sbbh.cloud
      password:
        sh: bww get password qbittorrent.sbbh.cloud
      mam_id:
        sh: tr -d '\n' < {{.SECRET_DIR}}/mam_id
    preconditions:
      - test -f {{.SECRET_DIR}}/mam_id
